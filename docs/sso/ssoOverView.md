---
sidebar_position: 2
description: SSO æ¦‚è§€
key: [sso, Single Sign-On]
tags: [sso, Single Sign-On]
---

# ðŸ” SSO æ¦‚è§€

## é—œæ–¼ SSO

> SSO (Single Sign-On): å–®é»žç™»å…¥
>
> æ˜¯ä¸€ç¨®èº«ä»½é©—è­‰å’ŒæŽˆæ¬Šæ©Ÿåˆ¶ï¼Œå…è¨±ä½¿ç”¨è€…åƒ…éœ€ä¸€æ¬¡ç™»å…¥ï¼Œç„¶å¾Œå°±èƒ½è¨ªå•å¤šå€‹ç›¸é—œçš„æ‡‰ç”¨ç¨‹å¼å’Œæœå‹™ï¼Œè€Œç„¡éœ€å†æ¬¡è¼¸å…¥å…¶èªè­‰è³‡è¨Š
>
> SSO æä¾›äº†æ–¹ä¾¿æ€§å’Œå®‰å…¨æ€§ï¼Œä¸¦æé«˜äº†ä½¿ç”¨è€…é«”é©—

## SSO é©ç”¨å ´æ™¯

å–®é»žç™»å…¥å¯æ‡‰ç”¨æ–¼å„ç¨®æƒ…å¢ƒï¼ŒåŒ…æ‹¬ï¼š

- ä¼æ¥­å…§éƒ¨ç’°å¢ƒï¼šåœ¨ä¼æ¥­å…§éƒ¨ï¼Œä½¿ç”¨è€…å¯ä»¥é€šéŽä¸€å€‹ç™»å…¥é é¢è¨ªå•æ‰€æœ‰å…§éƒ¨æ‡‰ç”¨ç¨‹å¼ï¼Œè€Œç„¡éœ€ç‚ºæ¯å€‹æ‡‰ç”¨ç¨‹å¼éƒ½æä¾›ä¸åŒçš„èªè­‰
- å¤šå€‹ç¶²ç«™æˆ–æ‡‰ç”¨ç¨‹å¼ï¼šç•¶ä¸€å€‹çµ„ç¹”æ“æœ‰å¤šå€‹ç¶²ç«™æˆ–æ‡‰ç”¨ç¨‹å¼æ™‚ï¼ŒSSO å…è¨±ä½¿ç”¨è€…åœ¨é€™äº›ç¶²ç«™æˆ–æ‡‰ç”¨ç¨‹å¼ä¹‹é–“å…±äº«ç›¸åŒçš„ç™»å…¥ç‹€æ…‹ï¼Œä»¥æ–¹ä¾¿ä»–å€‘çš„è¨ªå•
- é›²ç«¯æœå‹™ï¼šSSO é©ç”¨æ–¼ä½¿ç”¨å„ç¨®é›²ç«¯æœå‹™çš„æƒ…å¢ƒï¼Œä¾‹å¦‚é›»å­éƒµä»¶ã€æ–‡ä»¶å…±äº«ã€å°ˆæ¡ˆç®¡ç†ç­‰ä½¿ç”¨è€…åªéœ€ä¸€æ¬¡ç™»å…¥ï¼Œå³å¯è¨ªå•é€™äº›æœå‹™ï¼Œè€Œç„¡éœ€å¤šæ¬¡è¼¸å…¥å¯†ç¢¼

> SSO æä¾›äº†é›†ä¸­çš„èº«ä»½é©—è­‰å’ŒæŽˆæ¬Šï¼Œä¸¦æ¸›å°‘äº†å°å¤šå€‹ç™»å…¥èªè­‰çš„éœ€æ±‚ï¼ŒåŒæ™‚æä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§å’Œç®¡ç†æ€§å®ƒç°¡åŒ–äº†ä½¿ç”¨è€…çš„ç™»å…¥é«”é©—ï¼ŒåŒæ™‚æœ‰åŠ©æ–¼çµ„ç¹”ç¶­è­·å’Œç›£æŽ§è¨ªå•æ¬Šé™

## å‚³çµ±ç™»å…¥æ–¹å¼

### å‚³çµ±ç™»å…¥æ–¹å¼çš„è§’è‰²

- ä½¿ç”¨è€…ï¼šæ‡‰ç”¨ç¨‹åºçš„ä½¿ç”¨è€…ï¼Œå¸Œæœ›é€²è¡Œç™»å…¥
- ç€è¦½å™¨ï¼šä½¿ç”¨è€…ä½¿ç”¨çš„ç¶²é ç€è¦½å™¨ï¼Œç”¨æ–¼å‘å¾Œç«¯ä¼ºæœå™¨ç™¼é€è«‹æ±‚å’Œè™•ç†å›žæ‡‰
- å¾Œç«¯ä¼ºæœå™¨ï¼šæ‡‰ç”¨ç¨‹åºçš„ä¼ºæœå™¨ç«¯ï¼Œè² è²¬è™•ç†ä½¿ç”¨è€…çš„ç™»å…¥è«‹æ±‚ä¸¦é€²è¡Œèº«ä»½é©—è­‰

### å‚³çµ±ç™»å…¥æ–¹å¼æµç¨‹èªªæ˜Ž

1. ä½¿ç”¨è€…é–‹å§‹ç™»å…¥éŽç¨‹ï¼Œå‘å¾Œç«¯ä¼ºæœå™¨ç™¼é€ç™»å…¥è«‹æ±‚
2. å¾Œç«¯ä¼ºæœå™¨æŽ¥æ”¶ç™»å…¥è«‹æ±‚å¾Œï¼Œé–‹å§‹é©—è­‰ä½¿ç”¨è€…æä¾›çš„è³‡è¨Š
3. é©—è­‰æˆåŠŸçš„æƒ…æ³ä¸‹ï¼Œå¾Œç«¯ä¼ºæœå™¨å‘ç€è¦½å™¨å›žæ‡‰é¦–æ¬¡ç™»å…¥é©—è­‰æˆåŠŸçš„è¨Šæ¯
4. ç€è¦½å™¨æŽ¥æ”¶åˆ°æˆåŠŸçš„å›žæ‡‰å¾Œï¼ŒåŸ·è¡Œä»¥ä¸‹æ“ä½œï¼š
   - å„²å­˜ä½¿ç”¨è€…è³‡è¨Šåœ¨ Session ä¸­
   - è¨­å®š Set-Cookie æ¬„ä½ï¼Œå¯«å…¥ SessionId ç­‰è³‡è¨Šï¼Œè¨­å®šéŽæœŸæ™‚é–“ï¼Œå»ºç«‹ Cookie
   - ç€è¦½å™¨ä¿å­˜Cookieè³‡è¨Š
5. ç•¶ä½¿ç”¨è€…é€²è¡Œå¾ŒçºŒè«‹æ±‚æ™‚ï¼Œç€è¦½å™¨æœƒè‡ªå‹•é™„åŠ  Cookie è³‡è¨Šåˆ°è«‹æ±‚ä¸­
6. å¾Œç«¯ä¼ºæœå™¨æŽ¥å—å¾ŒçºŒè«‹æ±‚ï¼Œå¾žè«‹æ±‚æ¨™é ­ä¸­å–å‡º SessionId
7. å¾Œç«¯ä¼ºæœå™¨ä½¿ç”¨ SessionId å¾žä¼ºæœå™¨ Session ä¸­å–å¾—ä½¿ç”¨è€…è³‡è¨Š
8. æ ¹æ“šå–å¾—çš„ä½¿ç”¨è€…è³‡è¨Šï¼Œå¾Œç«¯ä¼ºæœå™¨åŸ·è¡Œä»¥ä¸‹æ“ä½œï¼š
   - å¦‚æžœæˆåŠŸå–å¾—ä½¿ç”¨è€…è³‡è¨Šï¼Œå‰‡å›žæ‡‰ `å·²ç™»å…¥` çš„è¨Šæ¯çµ¦ä½¿ç”¨è€…
   - å¦‚æžœæœªèƒ½æˆåŠŸå–å¾—ä½¿ç”¨è€…è³‡è¨Šï¼Œå‰‡å›žæ‡‰ `æœªç™»å…¥` çš„è¨Šæ¯çµ¦ä½¿ç”¨è€…
9. å¦‚æžœåœ¨åˆå§‹é©—è­‰éšŽæ®µé©—è­‰å¤±æ•—ï¼Œå¾Œç«¯ä¼ºæœå™¨ç›´æŽ¥å›žæ‡‰ `ç™»å…¥é©—è­‰å¤±æ•—` çš„è¨Šæ¯çµ¦ä½¿ç”¨è€…

### å‚³çµ±ç™»å…¥æ–¹å¼æµç¨‹åœ–

```mermaid
sequenceDiagram
    participant ä½¿ç”¨è€… as ä½¿ç”¨è€…
    participant ç€è¦½å™¨ as ç€è¦½å™¨
    participant å¾Œç«¯ as å¾Œç«¯ä¼ºæœå™¨

    ä½¿ç”¨è€…->>å¾Œç«¯: ç™¼é€ç™»å…¥è«‹æ±‚
    å¾Œç«¯->>å¾Œç«¯: é©—è­‰ä½¿ç”¨è€…è³‡è¨Š
    alt é©—è­‰æˆåŠŸ
        å¾Œç«¯-->>ç€è¦½å™¨: é¦–æ¬¡ç™»å…¥é©—è­‰æˆåŠŸ
        ç€è¦½å™¨->>ç€è¦½å™¨: å„²å­˜ä½¿ç”¨è€…è³‡è¨Šåœ¨Sessionä¸­
        ç€è¦½å™¨->>ç€è¦½å™¨: è¨­å®šSet-Cookieæ¬„ä½ï¼Œå¯«å…¥ SessionId ç­‰è³‡è¨Šï¼Œè¨­å®šéŽæœŸæ™‚é–“ï¼Œå»ºç«‹Cookie
        ç€è¦½å™¨->>ç€è¦½å™¨: ç€è¦½å™¨ä¿å­˜Cookieè³‡è¨Š
        ç€è¦½å™¨->>å¾Œç«¯: å…¶ä»–ä»‹é¢è«‹æ±‚æ™‚ï¼Œç€è¦½å™¨è‡ªå‹•é™„åŠ Cookieè³‡è¨Š
        å¾Œç«¯->>å¾Œç«¯: å¾Œç«¯æŽ¥å—è«‹æ±‚ï¼Œå¾žè«‹æ±‚æ¨™é ­ä¸­å–å‡º SessionId 
        å¾Œç«¯->>å¾Œç«¯: å¾žä¼ºæœå™¨Sessionä¸­å–å¾—ä½¿ç”¨è€…è³‡è¨Š
        alt å–å¾—æˆåŠŸ
            å¾Œç«¯-->>å¾Œç«¯: ç™»å…¥é©—è­‰æˆåŠŸ
            å¾Œç«¯-->>ä½¿ç”¨è€…: å·²ç™»å…¥
        else å–å¾—å¤±æ•—
            å¾Œç«¯-->>å¾Œç«¯: ç™»å…¥é©—è­‰å¤±æ•—
            å¾Œç«¯-->>ä½¿ç”¨è€…: æœªç™»å…¥
        end
    else é©—è­‰å¤±æ•—
        å¾Œç«¯-->>ä½¿ç”¨è€…: ç™»å…¥é©—è­‰å¤±æ•—
    end
```

### å‚³çµ±ç™»å…¥å¤šç³»çµ±çš„ç“¶é ¸

> åœ¨å–®é«”çš„ç³»çµ±ä¸­ï¼Œç™»å…¥çµåˆäº† `Cookie` èˆ‡ `Session`
>
> åœ¨å¤šç³»çµ±ç™»å…¥ä¹‹ä¸‹æœƒæœ‰ç¢°åˆ°å…©å€‹ç“¶é ¸

1. `Session` ç„¡æ³•å…±äº«
2. `Cookie` ç„¡æ³•è·¨åŸŸ

åœ¨å¤šç³»çµ±æƒ…æ³ä¸‹ï¼Œæœå‹™å™¨ç«¯ Session ä¸å…±äº«ï¼Œé€™æ„å‘³è‘—ç•¶ç”¨æˆ¶åœ¨ä¸åŒç³»çµ±ä¹‹é–“åˆ‡æ›æ™‚ï¼Œä»–å€‘çš„ Session æ•¸æ“šä¸æœƒå…±äº«ï¼Œé€™å¯èƒ½æœƒå°Žè‡´ç™»å…¥ç‹€æ…‹çš„ä¸Ÿå¤±

### è§£æ±º Session ç„¡æ³•å…±äº«

> æœ‰ä¸‰ç¨®å¸¸è¦‹çš„æ–¹å¼ä¾†è§£æ±º Session ç„¡æ³•å…±äº«çš„å•é¡Œ

1. Session æ‹·è²ï¼š
    - ç•¶å…¶ä¸­æœå‹™å° Session ä¸­çš„è³‡è¨Šé€²è¡Œä¿®æ”¹æ™‚ï¼Œé€™äº›ä¿®æ”¹å°‡åŒæ­¥çµ¦å…¶ä»–æœå‹™ï¼Œä»¥å¯¦ç¾Sessionå…±äº«
    - ç¼ºé»žï¼šå¯èƒ½æœƒå¢žåŠ ä¼ºæœå™¨ç«¯çš„å£“åŠ›å’Œå¯èƒ½çš„å»¶é²
2. ä½¿ç”¨ Redisï¼š
   - å®ƒå…·æœ‰é«˜æ•ˆçš„å­˜å„²å’ŒæŸ¥è©¢èƒ½åŠ›ï¼Œä¸¦æ”¯æŒæ•¸æ“šæŒä¹…åŒ–ï¼Œä¸æ˜“ä¸Ÿå¤±è³‡æ–™
3. ä½¿ç”¨ JWTï¼ˆJSON Web Tokensï¼‰ï¼š
   - æœå‹™åªéœ€æˆåŠŸè§£æž JWTï¼Œå°±å¯ä»¥ç²å–ä½¿ç”¨è€…çš„è³‡è¨Š
   - å‰ç«¯ Cookie åªéœ€è¦å­˜å„²JWTï¼Œè€Œä¸éœ€è¦æŸ¥è©¢æœå‹™çš„ Session

## SSO åŽŸç†

### æ ¸å¿ƒæˆå“¡ - æ‡‰ç”¨ç³»çµ±

- **æ‡‰ç”¨ç³»çµ±**ï¼ˆApplication Systemï¼‰ï¼š
  - é€™æ˜¯éœ€è¦èº«ä»½é©—è­‰çš„ç›®æ¨™ç³»çµ±ï¼Œç”¨æˆ¶å¸Œæœ›è¨ªå•çš„æ‡‰ç”¨ç¨‹å¼
  - æ‡‰ç”¨ç³»çµ±å¯èƒ½åŒ…æ‹¬ç¶²ç«™ã€æ‡‰ç”¨ç¨‹å¼æˆ–å…¶ä»–æœå‹™ï¼Œä¸¦éœ€è¦ç”¨æˆ¶é€šéŽ SSO é€²è¡Œèº«ä»½é©—è­‰ï¼Œä»¥ç¢ºä¿åªæœ‰æŽˆæ¬Šçš„ç”¨æˆ¶å¯ä»¥è¨ªå•å®ƒ

### æ ¸å¿ƒæˆå“¡ - å®¢æˆ¶ç«¯

- **SSO å®¢æˆ¶ç«¯**ï¼ˆSSO Clientï¼‰ï¼š
  - SSO å®¢æˆ¶ç«¯è² è²¬è™•ç†ç”¨æˆ¶çš„ç™»å…¥å’Œç™»å‡º
  - ä¸¦èˆ‡ SSO æœå‹™ç«¯é€²è¡Œé€šä¿¡ä»¥é©—è­‰ç”¨æˆ¶çš„èº«ä»½

### æ ¸å¿ƒæˆå“¡ - æœå‹™ç«¯

- **SSO æœå‹™ç«¯**ï¼ˆSSO Serverï¼‰ï¼š
- é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å­è§’è‰²ï¼š
  - **ç™»å…¥æœå‹™**ï¼šè² è²¬è™•ç†ç”¨æˆ¶çš„èº«ä»½é©—è­‰å’Œç”Ÿæˆ tokenï¼ˆä¾‹å¦‚ï¼ŒJWTï¼‰ä»¥è­‰æ˜Žç”¨æˆ¶çš„èº«ä»½
  - **ç™»å…¥ç‹€æ…‹æœå‹™**ï¼šæä¾›äº†é©—è­‰ç”¨æˆ¶çš„ç™»å…¥ç‹€æ…‹å’Œç™»å…¥è¨Šæ¯æŸ¥è©¢çš„æœå‹™
  - **é€€å‡ºæœå‹™**ï¼šç”¨æˆ¶æ³¨éŠ·æœå‹™ï¼Œå…è¨±ç”¨æˆ¶ç™»å‡º SSO ç³»çµ±

### æ ¸å¿ƒæˆå“¡ - è³‡æ–™åº«

- **è³‡æ–™åº«**ï¼ˆDatabaseï¼‰ï¼š
  - é€™æ˜¯ç”¨æ–¼å­˜å„²ä½¿ç”¨è€…è³‡è¨Šçš„åœ°æ–¹

### æ ¸å¿ƒæˆå“¡ - å¿«å–

- **å¿«å–**ï¼ˆCacheï¼‰ï¼š
  - é€™æ˜¯ç”¨æ–¼å­˜å„²ç”¨æˆ¶çš„ç™»å…¥è¨Šæ¯çš„ç³»çµ±ï¼Œé€šå¸¸ä½¿ç”¨ Redis æˆ–é¡žä¼¼çš„å¿«å–å­˜å„²
  - å®ƒç”¨æ–¼æé«˜æ€§èƒ½ï¼Œæ¸›å°‘å°æ•¸æ“šåº«çš„æŸ¥è©¢ï¼Œä»¥é©—è­‰ç”¨æˆ¶çš„ç™»å…¥ç‹€æ…‹

### SSO æµç¨‹åœ– - ç™»å…¥

```mermaid
sequenceDiagram
    participant User
    participant Service
    participant SSO Provider

    User ->> SSO Provider: ç™»å…¥è«‹æ±‚
    SSO Provider ->> User: æç¤ºç™»å…¥
    User ->> SSO Provider: æä¾›èªè­‰
    SSO Provider -->> SSO Provider: é©—è­‰èªè­‰
    SSO Provider -->> User: ç™»å…¥æˆåŠŸ
    User ->> Service: å­˜å–å—ä¿è­·çš„æœå‹™
    Service -->> SSO Provider: æª¢æŸ¥é©—è­‰
    SSO Provider -->> Service: é©—è­‰æˆåŠŸ
    Service -->> User: å­˜å–æŽˆæ¬Š
```

### SSO æµç¨‹åœ– - ç™»å…¥ç¬¬äºŒæœå‹™

```mermaid
sequenceDiagram
    participant User
    participant Service1
    participant Service2
    participant SSO Provider

    User ->> SSO Provider: ç™»å…¥è«‹æ±‚
    SSO Provider ->> User: å·²ç™»å…¥
    User ->> SSO Provider: æä¾›èªè­‰
    SSO Provider -->> SSO Provider: é©—è­‰èªè­‰
    SSO Provider -->> User: ç™»å…¥æˆåŠŸ
    User ->> Service1: å­˜å–å—ä¿è­·çš„æœå‹™1
    Service1 -->> SSO Provider: æª¢æŸ¥é©—è­‰
    SSO Provider -->> Service1: é©—è­‰æˆåŠŸ
    Service1 -->> User: å­˜å–æŽˆæ¬Š1

    User ->> SSO Provider: ç™»å…¥è«‹æ±‚ (ç¬¬äºŒç³»çµ±)
    SSO Provider ->> User: å·²ç™»å…¥
    User ->> SSO Provider: æä¾›èªè­‰ (ç¬¬äºŒç³»çµ±)
    SSO Provider -->> SSO Provider: é©—è­‰èªè­‰ (ç¬¬äºŒç³»çµ±)
    SSO Provider -->> User: ç™»å…¥æˆåŠŸ (ç¬¬äºŒç³»çµ±)
    User ->> Service2: å­˜å–å—ä¿è­·çš„æœå‹™2
    Service2 -->> SSO Provider: æª¢æŸ¥é©—è­‰ (ç¬¬äºŒç³»çµ±)
    SSO Provider -->> Service2: é©—è­‰æˆåŠŸ (ç¬¬äºŒç³»çµ±)
    Service2 -->> User: å­˜å–æŽˆæ¬Š2
```

### SSO æµç¨‹åœ– - ç™»å‡º

```mermaid
sequenceDiagram
    participant User
    participant Service1
    participant Service2
    participant SSO Provider

    User ->> SSO Provider: ç™»å‡ºè«‹æ±‚
    SSO Provider ->> User: ç¢ºèªç™»å‡º
    SSO Provider ->> Service1: é€šçŸ¥ç™»å‡º
    SSO Provider ->> Service2: é€šçŸ¥ç™»å‡º
    Service1 ->> SSO Provider: ç¢ºèªç™»å‡º
    Service2 ->> SSO Provider: ç¢ºèªç™»å‡º
    SSO Provider -->> User: ç™»å‡ºæˆåŠŸ
    User -->> Service1: ç™»å‡º
    User -->> Service2: ç™»å‡º
```
