---
sidebar_position: 30
description: äº«å…ƒæ¨¡å¼ (Flyweight Pattern) 
key: [è¨­è¨ˆæ¨¡å¼, Design Pattern, é–€é¢æ¨¡å¼ , Flyweight Pattern]
tags: [è¨­è¨ˆæ¨¡å¼, Design Pattern]
---

# ğŸ’¡ äº«å…ƒæ¨¡å¼

## æ¦‚è¿°

äº«å…ƒæ¨¡å¼æ˜¯ä¸€ç¨®çµæ§‹å‹è¨­è¨ˆæ¨¡å¼ï¼Œç”¨æ–¼æœ€å°åŒ–æˆ–å…±äº«ç‰©ä»¶ï¼Œä»¥ç¯€çœè¨˜æ†¶é«”æˆ–æé«˜æ€§èƒ½

è©²æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°‡å…±äº«çš„ç‹€æ…‹ï¼ˆä¹Ÿå°±æ˜¯å…§éƒ¨ç‹€æ…‹ï¼‰èˆ‡ç‰©ä»¶çš„å…¶é¤˜éƒ¨åˆ†ï¼ˆå¤–éƒ¨ç‹€æ…‹ï¼‰åˆ†é–‹

é€™æ¨£å¤šå€‹ç‰©ä»¶å¯ä»¥å…±äº«ç›¸åŒçš„å…§éƒ¨ç‹€æ…‹ï¼Œå¾è€Œæ¸›å°‘è¨˜æ†¶é«”ä½¿ç”¨

äº«å…ƒæ¨¡å¼ä¸»è¦ç”¨æ–¼ç®¡ç†å¤§é‡ç›¸ä¼¼çš„ç‰©ä»¶ï¼Œä¸¦ç¢ºä¿å®ƒå€‘åœ¨è¨˜æ†¶é«”ä¸­åƒ…æœ‰ä¸€å€‹å¯¦é«”

é€™ç¨®å…±äº«çš„æ–¹å¼å¯ç”¨æ–¼æé«˜ç³»çµ±çš„æ•ˆç‡ï¼Œç‰¹åˆ¥æ˜¯ç•¶æœ‰å¤§é‡ç›¸ä¼¼ç‰©ä»¶éœ€è¦è™•ç†æ™‚

### äº«å…ƒæ¨¡å¼ä¸»è¦è§£æ±ºä»¥ä¸‹å•é¡Œ

- å„ªé»
  - æ¸›å°‘è¨˜æ†¶é«”æ¶ˆè€—ï¼šäº«å…ƒæ¨¡å¼å…è¨±å¤šå€‹ç‰©ä»¶å…±äº«ç›¸åŒçš„å…§éƒ¨ç‹€æ…‹ï¼Œå¾è€Œæ¸›å°‘è¨˜æ†¶é«”æ¶ˆè€—
  - æé«˜æ€§èƒ½ï¼šé€šéå…±äº«å…§éƒ¨ç‹€æ…‹ï¼Œäº«å…ƒæ¨¡å¼å¯ä»¥æé«˜ç³»çµ±çš„æ€§èƒ½ï¼Œç‰¹åˆ¥æ˜¯åœ¨è™•ç†å¤§é‡ç›¸ä¼¼ç‰©ä»¶æ™‚
  - æ”¯æŒå¤§é‡ç‰©ä»¶ï¼šäº«å…ƒæ¨¡å¼é©ç”¨æ–¼éœ€è¦ç®¡ç†å¤§é‡ç›¸ä¼¼ç‰©ä»¶çš„æƒ…æ³
- ç¼ºé»
  - è¤‡é›œæ€§å¢åŠ ï¼šå¯¦ç¾äº«å…ƒæ¨¡å¼å¯èƒ½éœ€è¦å¼•å…¥é¡å¤–çš„è¤‡é›œæ€§ï¼Œå¦‚å…§éƒ¨ç‹€æ…‹çš„ç®¡ç†å’Œå¤–éƒ¨ç‹€æ…‹çš„è™•ç†

### äº«å…ƒæ¨¡å¼åŒ…å«

1. äº«å…ƒå·¥å» ï¼ˆFlyweight Factoryï¼‰ï¼šè² è²¬å»ºç«‹å’Œç®¡ç†äº«å…ƒç‰©ä»¶ï¼Œå®ƒç¶­è­·ä¸€å€‹äº«å…ƒæ± ï¼Œä»¥ä¾¿é‡è¤‡ä½¿ç”¨äº«å…ƒç‰©ä»¶
2. äº«å…ƒï¼ˆFlyweightï¼‰ï¼šè¡¨ç¤ºä¸€å€‹å…±äº«çš„å…§éƒ¨ç‹€æ…‹ï¼Œè©²ç‹€æ…‹å¯ä»¥è¢«å¤šå€‹ç‰©ä»¶å…±äº«ï¼Œäº«å…ƒç‰©ä»¶åŒ…å«å…§éƒ¨ç‹€æ…‹å’Œå¯ä»¥è®ŠåŒ–çš„å¤–éƒ¨ç‹€æ…‹
3. å®¢æˆ¶ç«¯ï¼ˆClientï¼‰ï¼šä½¿ç”¨äº«å…ƒç‰©ä»¶çš„ç‰©ä»¶ï¼Œå®¢æˆ¶ç«¯å¯ä»¥é€šéäº«å…ƒå·¥å» ç²å–äº«å…ƒç‰©ä»¶ï¼Œä¸¦è¨­ç½®å¤–éƒ¨ç‹€æ…‹

## ç¯„ä¾‹

### 1. å®šç¾©äº«å…ƒä»‹é¢

```csharp
// äº«å…ƒä»‹é¢
public interface IFlyweight
{
    void Operation(string externalState);
}
```

### 2. å¯¦ä½œå…·é«”äº«å…ƒé¡åˆ¥

```csharp
// å…·é«”äº«å…ƒé¡åˆ¥
public class ConcreteFlyweight : IFlyweight
{
    private string intrinsicState; // å…§éƒ¨ç‹€æ…‹

    public ConcreteFlyweight(string intrinsicState)
    {
        this.intrinsicState = intrinsicState;
    }

    public void Operation(string externalState)
    {
        Console.WriteLine($"å…§éƒ¨ç‹€æ…‹ï¼š{intrinsicState}, å¤–éƒ¨ç‹€æ…‹ï¼š{externalState}");
    }
}
```

### 3. å¯¦ä½œäº«å…ƒå·¥å» 

```csharp
// äº«å…ƒå·¥å» 
public class FlyweightFactory
{
    private Dictionary<string, IFlyweight> flyweights = new Dictionary<string, IFlyweight>();

    public IFlyweight GetFlyweight(string key)
    {
        if (!flyweights.ContainsKey(key))
        {
            flyweights[key] = new ConcreteFlyweight(key);
        }
        return flyweights[key];
    }
}
```

### 4. å¯¦éš›ä½¿ç”¨

```csharp
class Program
{
    static void Main(string[] args)
    {
        FlyweightFactory factory = new FlyweightFactory();

        IFlyweight flyweight1 = factory.GetFlyweight("A");
        flyweight1.Operation("X");

        IFlyweight flyweight2 = factory.GetFlyweight("B");
        flyweight2.Operation("Y");

        IFlyweight flyweight3 = factory.GetFlyweight("A");
        flyweight3.Operation("Z");
    }
}
```

### 5. çµæœ

- è¼¸å‡º:

```text
å…§éƒ¨ç‹€æ…‹ï¼šA, å¤–éƒ¨ç‹€æ…‹ï¼šX
å…§éƒ¨ç‹€æ…‹ï¼šB, å¤–éƒ¨ç‹€æ…‹ï¼šY
å…§éƒ¨ç‹€æ…‹ï¼šA, å¤–éƒ¨ç‹€æ…‹ï¼šZ
```

---

äº«å…ƒæ¨¡å¼å…è¨±å…±äº«å…§éƒ¨ç‹€æ…‹ï¼Œå¾è€Œæ¸›å°‘è¨˜æ†¶é«”æ¶ˆè€—ä¸¦æé«˜æ€§èƒ½ï¼Œé€™åœ¨éœ€è¦è™•ç†å¤§é‡ç›¸ä¼¼ç‰©ä»¶çš„æƒ…æ³ä¸‹ç‰¹åˆ¥æœ‰ç”¨ï¼Œé€šéå°‡å…§éƒ¨ç‹€æ…‹å’Œå¤–éƒ¨ç‹€æ…‹åˆ†é›¢ï¼Œäº«å…ƒæ¨¡å¼å¯¦ç¾äº†å°ç‰©ä»¶çš„æœ‰æ•ˆå…±äº«
