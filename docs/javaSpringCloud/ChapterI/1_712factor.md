---
sidebar_position: 35
description: 12 å› å­æ‡‰ç”¨ç¨‹å¼
key: [java, Spring Cloud, Microservices, å¾®æœå‹™, The twelve-factor App]
tags: [java, Spring Cloud, Microservices]
---

# ğŸŒ§ï¸ 12 å› å­æ‡‰ç”¨ç¨‹å¼

## ç›®æ¨™

- æ¨™æº–åŒ–æµç¨‹
- å¢åŠ æœå‹™çš„å¯ç§»æ¤æ€§ (portability)
- é©åˆéƒ¨å±¬åˆ°é›²å¹³å° (cloud platforms)
- æé«˜æŒçºŒéƒ¨å±¬çš„å¯è¡Œæ€§ (continuous deployment)
- æé«˜ç³»çµ±çš„æ“´å±•æ€§  (scale up)

## 12 å› å­

### 1. åŸºç¤ç¨‹å¼ç¢¼ (Codebase)

1. åŸºç¤ç¨‹å¼ç¢¼
   - é›†ä¸­å¼ç‰ˆæ§æŒ‡çš„æ˜¯ç³»çµ±ä¸Šçš„å„²å­˜åº« (ex: SVNæ‡‰è©²ä»¥æœ€å¾Œä¸€å€‹ç‰ˆæœ¬ç‚ºä¸»)
   - åˆ†æ•£å¼ç‰ˆæ§æŒ‡çš„æ˜¯æœ€ä¸Šæ¸¸çš„å„²å­˜åº« (ex: å¦‚æœ git ä¸Šçš„Repoæ˜¯forkä¾†çš„ï¼Œæ‡‰è©²ä»¥forkå‰çš„ç‚ºä¸») (ex: git æ‡‰è©²ä»¥é›²ç«¯æœ€æ–°çš„ç‰ˆæœ¬ç‚ºä¸»)
2. åŸºç¤ç¨‹å¼ç¢¼èˆ‡æ‡‰ç”¨ç¨‹å¼çš„é—œä¿‚:
   - ä¸€ä»½åŸºç¤ç¨‹å¼ç¢¼ï¼Œå°æ‡‰ä¸€å€‹æ‡‰ç”¨ç¨‹å¼
   - ä¸€ä»½åŸºç¤ç¨‹å¼ç¢¼ï¼Œå°æ‡‰å¤šå€‹æ‡‰ç”¨ç¨‹å¼
   - å¤šä»½åŸºç¤ç¨‹å¼ç¢¼ï¼Œæ˜¯ä¸€å€‹åˆ†æ•£å¼ç³»çµ±

> åŸºç¤ç¨‹å¼ç¢¼åªèƒ½æœ‰ä¸€ä»½ï¼Œä½†å¯ä»¥éƒ¨å±¬æˆå¤šå€‹æ‡‰ç”¨ç¨‹å¼

### 2. ä¾è³´è²æ˜ (Dependencies)

- ä¾è³´ç®¡ç†å·¥å…·å¯èƒ½å®‰è£çš„å¥—ä»¶é¡å‹:
  - ç³»çµ±å±¤ç´šå…¨åŸŸçš„ä¾è³´ (ex: python fastapi)
  - æ‡‰ç”¨ç¨‹å¼å°ˆå±¬ä½¿ç”¨çš„ (ex: dotnet log4net)

- ä¾è³´ç®¡ç†å·¥å…·åšæ³•: (ä»¥Pythonç‚ºä¾‹)
  - ä¾è³´è²æ˜ (requirements.txt)
  - ä¾è³´éš”é›¢ (venv)
  - ä¾è³´å»ºç½® (pip install)

### 3. è¨­å®š(Config)

- å› ç’°å¢ƒå·®ç•°è€Œæœ‰æ‰€ä¸åŒ
  - è³‡æ–™åº«è¨­å®š
  - ç¬¬ä¸‰æ–¹æœå‹™çš„å­˜å–æ†‘è­‰
  - ç’°å¢ƒç‰¹æœ‰çš„è¨­å®š (ex: ç¶²åŸŸ )

> å»ºè­°ä½¿ç”¨ç’°å¢ƒè®Šæ•¸

- åä¾‹:
  - ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨å¸¸æ•¸
  - ä½¿ç”¨è¨­å®šæª”

### 4. å¾Œç«¯æœå‹™(Backing services)

- å®šç¾©
  - æ‡‰ç”¨ç¨‹å¼åŸ·è¡Œä¸­éœ€è¦é€éç¶²è·¯å‘¼å«çš„æœå‹™
  - è³‡æ–™åº«ã€Queueã€SMTPã€å¿«å–ç­‰ï¼Œå…§éƒ¨æœå‹™
  - Google APIï¼Œå¤–éƒ¨æœå‹™

> ä½œç‚ºæ‡‰ç”¨ç¨‹å¼çš„é™„åŠ è³‡æºï¼Œä½¿ç”¨URLæˆ–æ˜¯å…¶ä»–å½¢å¼ï¼Œå­˜åœ¨è¨­å®šç®¡ç†
>
> åœ¨è³‡æ–™åº«å‡ºå•é¡Œæ™‚ï¼Œæ‡‰è©²å…ˆå°‡å‚™ä»½çš„è³‡æ–™åº«å•Ÿå‹•ï¼Œä¸¦ä¿®æ”¹ç’°å¢ƒè®Šæ•¸ä¸­çš„é€£ç·šå­—ä¸²ï¼Œå¯èƒ½æœƒæœ‰ä¸€äº›è³‡æ–™è½å·®ï¼Œä½†ç•¶ä¸‹å¯ä»¥å¾©æ­¸ç³»çµ±

### 5.å»ºç½®ã€ç™¼å¸ƒã€åŸ·è¡Œ(Build, release, run)

- å®šç¾©åŸºç¤ç¨‹å¼ç¢¼è½‰æ›ç‚ºéƒ¨å±¬çš„éšæ®µ:
  - å»ºç½®éšæ®µ > é€éç·¨è­¯å™¨ï¼Œæº–å‚™å¥½ä¾è³´ï¼Œæ‰“åŒ…æˆä¸€å€‹åŸ·è¡Œæª”â€¦
  - ç™¼å¸ƒéšæ®µ > æº–å‚™å¥½æ‰“åŒ…å¾Œçš„ç¨‹å¼èˆ‡è¨­å®šæª”
  - åŸ·è¡Œéšæ®µ > ç•¶ç¨‹å¼ç¢¼å•Ÿå‹•ä¹‹å¾Œç”¢ç”Ÿä¸€å€‹ processes

> Release æ‡‰è©²ä½¿ç”¨ç‰ˆè™Ÿæˆ–æ˜¯ä¸€å€‹æµæ°´è™Ÿï¼Œå¥½è™•æ˜¯å¯ä»¥ç¢ºå®šReleaseå¾Œçš„ç¨‹å¼éƒ½æ‡‰è©²è¦å¯ä»¥ç›´æ¥åœ¨PDç’°å¢ƒä¸ŠåŸ·è¡Œ

### 6.ç¨‹åº(Processes)

- ä¸€å€‹æ‡‰ç”¨ç¨‹å¼é€šå¸¸æ˜¯ç”±ä¸€å€‹æˆ–å¤šå€‹ç¨‹åºåŸ·è¡Œçš„
- ç¨‹åºéœ€ç‚ºç„¡ç‹€æ…‹ä¸”ç„¡å…±äº«(æ‡‰ä¿å­˜åœ¨å¾Œç«¯æœå‹™å…§)
  - ç„¡ç‹€æ…‹  > å‰ä¸€å€‹è«‹æ±‚ä¸æ‡‰è©²å½±éŸ¿åˆ°ä¸‹ä¸€å€‹è«‹æ±‚çš„ç‹€æ…‹
  - ç„¡å…±äº« > è¨˜æ†¶é«”ä¸­æ˜¯ä¸æœƒäº’ç›¸å½±éŸ¿çš„

### 7.ç«¯å£ç¶å®š(Port binding)

> æ‡‰ç”¨ç¨‹å¼æ‡‰è©²è¦èƒ½å¤ è‡ªè¡Œå»ºç«‹ç¶²è·¯æœå‹™ï¼Œä¸¦é€éç«¯å£ç¶å®šä¾†æä¾›æœå‹™

- åä¾‹: C# ä¾è³´ IIS ã€Java ä¾è³´ Tomcat
- æ­£ä¾‹: C# èˆ‡ ASP.NET Coreã€ Java èˆ‡ Jetty æˆ– Spring Boot

### 8.ä½µç™¼(Concurrency)

> ä»¥PHPç‚ºä¾‹ï¼Œåœ¨Apacheå•Ÿå‹•æ™‚åªæœƒå•Ÿå‹•æœ€å°Processesï¼Œä¸¦åœ¨ä½¿ç”¨æ™‚é€²è¡Œå‹•æ…‹å¢é•·
>
> å¦å¤–ä»¥Javaç‚ºä¾‹ï¼Œåœ¨å•Ÿå‹•æ™‚æœƒå°‡Processeséƒ½å…ˆå•Ÿå‹•å¥½ï¼Œåœ¨è«‹æ±‚é€²ä¾†æ™‚ï¼Œé€²è¡Œåˆ†é…

- ä¸åŒçš„å·¥ä½œæœƒäº¤çµ¦ä¸åŒçš„ç¨‹åºè™•ç†
- æ‡‰è©²ä½¿ç¨‹åºç®¡ç†å·¥å…·(systemd)ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¸¸é§ç¨‹å¼

### 9. ä¸€æ¬¡æ€§çš„(Disposability)

> æ‡‰ç”¨ç¨‹å¼æ˜¯ä¸€æ¬¡æ€§çš„

- å¿«é€Ÿå•Ÿå‹• (fast startup)
- å„ªé›…çµ‚æ­¢ (graceful shutdown)

### 10. é–‹ç™¼ç’°å¢ƒèˆ‡ç·šä¸Šç’°å¢ƒç›¸åŒ

> å¯èƒ½çš„å·®ç•°

- ç¨‹å¼ç¢¼å·®ç•° > å¯èƒ½å› ç‚ºæ­£åœ¨é–‹ç™¼æ–°åŠŸèƒ½è€Œé€ æˆç¨‹å¼ç¢¼å·®ç•°
- ç®¡ç†å·®ç•° > é–‹ç™¼èˆ‡ç¶­é‹äººå“¡ä¸åŒé€ æˆç®¡ç†å·®ç•°
- æœå‹™å·®ç•° > å¾Œç«¯æœå‹™çš„å·®ç•°ï¼Œç·šä¸Šä½¿ç”¨MySQLï¼Œé–‹ç™¼ä½¿ç”¨MSSQL

### 11. æ—¥èªŒ(Logs)

- ä¸å„²å­˜ã€ä¸ç®¡ç†ï¼Œæ™‚æ©Ÿåˆ°äº†è‡ªå‹•stdoutå‡ºå»
- ç”±å…¶ä»–æ¥æ”¶é€™ä¾†è™•ç†é€™äº›Log (ex: [ELK Stack](https://www.elastic.co/cn/what-is/elk-stack))

### 12. ç®¡ç†è€…ç¨‹åº(Admin processes)

> ç®¡ç†ä»»å‹™ä½œç‚ºä¸€æ¬¡æ€§ç¨‹åºåŸ·è¡Œ
>
> EX: Entity Framework Core ä½¿ç”¨ dotnet CLI åˆªé™¤è³‡æ–™åº«

```shell
dotnet ef database drop
```

> æ­¤ä»»å‹™åŸ·è¡Œä¸€æ¬¡ä¹‹å¾Œå°±çµæŸäº†

---

## åƒè€ƒ

[The Twelve-Factor App](https://12factor.net/)

[DevOps Taiwan Community - Meetup 45 - é›²åŸç”Ÿæ™‚ä»£çš„è»Ÿé«”é–‹ç™¼é ˆçŸ¥, Miles Chou](https://youtu.be/P-6uwBmaH-g)
