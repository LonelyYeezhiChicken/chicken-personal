"use strict";(self.webpackChunkchicken_personal=self.webpackChunkchicken_personal||[]).push([[20457],{49613:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>u});var r=t(59496);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),E=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=E(e.components);return r.createElement(o.Provider,{value:n},e.children)},N="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},T=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),N=E(t),T=a,u=N["".concat(o,".").concat(T)]||N[T]||d[T]||i;return t?r.createElement(u,s(s({ref:n},p),{},{components:t})):r.createElement(u,s({ref:n},p))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,s=new Array(i);s[0]=T;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l[N]="string"==typeof e?e:a,s[1]=l;for(var E=2;E<i;E++)s[E]=t[E];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}T.displayName="MDXCreateElement"},63998:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>E});var r=t(88028),a=(t(59496),t(49613));const i={sidebar_position:10,description:"SSO \u8cc7\u6599\u5eab",key:["sso","Single Sign-On"],tags:["sso","Single Sign-On","Postgresql"]},s="\ud83d\udd10 SSO \u8cc7\u6599\u5eab",l={unversionedId:"sso/database",id:"sso/database",title:"\ud83d\udd10 SSO \u8cc7\u6599\u5eab",description:"SSO \u8cc7\u6599\u5eab",source:"@site/docs/sso/database.md",sourceDirName:"sso",slug:"/sso/database",permalink:"/en/docs/sso/database",draft:!1,editUrl:"https://github.com/LonelyYeezhiChicken/chicken-personal/tree/main/docs/sso/database.md",tags:[{label:"sso",permalink:"/en/docs/tags/sso"},{label:"Single Sign-On",permalink:"/en/docs/tags/single-sign-on"},{label:"Postgresql",permalink:"/en/docs/tags/postgresql"}],version:"current",lastUpdatedAt:1769578148,formattedLastUpdatedAt:"Jan 28, 2026",sidebarPosition:10,frontMatter:{sidebar_position:10,description:"SSO \u8cc7\u6599\u5eab",key:["sso","Single Sign-On"],tags:["sso","Single Sign-On","Postgresql"]},sidebar:"tutorialSidebar",previous:{title:"\ud83d\udd10 SSO \u529f\u80fd\u6a21\u7d44",permalink:"/en/docs/sso/appMpdel"},next:{title:"\ud83d\udd10 SSO \u5efa\u7acb\u5c08\u6848",permalink:"/en/docs/sso/createProject"}},o={},E=[{value:"\u4f55\u8b02 SSO",id:"\u4f55\u8b02-sso",level:2},{value:"\u8cc7\u6599\u5eab",id:"\u8cc7\u6599\u5eab",level:2},{value:"\u8cc7\u6599\u5eab\u8a2d\u8a08\u8003\u91cf",id:"\u8cc7\u6599\u5eab\u8a2d\u8a08\u8003\u91cf",level:3},{value:"1. User Table\uff08\u4f7f\u7528\u8005\u8868\u683c\uff09",id:"1-user-table\u4f7f\u7528\u8005\u8868\u683c",level:3},{value:"2. Refresh Token Table\uff08\u5237\u65b0\u6b0a\u6756\u8868\u683c\uff09",id:"2-refresh-token-table\u5237\u65b0\u6b0a\u6756\u8868\u683c",level:3},{value:"3. Application Table\uff08\u61c9\u7528\u7a0b\u5f0f\u8868\u683c\uff09",id:"3-application-table\u61c9\u7528\u7a0b\u5f0f\u8868\u683c",level:3},{value:"4. User-Application Consent Table\uff08\u4f7f\u7528\u8005\u61c9\u7528\u7a0b\u5f0f\u6388\u6b0a\u8868\u683c\uff09",id:"4-user-application-consent-table\u4f7f\u7528\u8005\u61c9\u7528\u7a0b\u5f0f\u6388\u6b0a\u8868\u683c",level:3},{value:"5. Audit Log Table\uff08\u5be9\u8a08\u65e5\u8a8c\u8868\u683c\uff09",id:"5-audit-log-table\u5be9\u8a08\u65e5\u8a8c\u8868\u683c",level:3},{value:"6. Role and Permission Tables\uff08\u89d2\u8272\u8207\u6b0a\u9650\u8868\u683c\uff09",id:"6-role-and-permission-tables\u89d2\u8272\u8207\u6b0a\u9650\u8868\u683c",level:3},{value:"\u5b8c\u6574 SQL",id:"\u5b8c\u6574-sql",level:2}],p={toc:E},N="wrapper";function d(e){let{components:n,...t}=e;return(0,a.kt)(N,(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"-sso-\u8cc7\u6599\u5eab"},"\ud83d\udd10 SSO \u8cc7\u6599\u5eab"),(0,a.kt)("h2",{id:"\u4f55\u8b02-sso"},"\u4f55\u8b02 SSO"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u55ae\u9ede\u767b\u9304\uff08Single Sign-On\uff0cSSO\uff09\u662f\u4e00\u7a2e\u8eab\u4efd\u9a57\u8b49\u6a5f\u5236\uff0c\u5141\u8a31\u4f7f\u7528\u8005\u4f7f\u7528\u4e00\u7d44\u6191\u8b49\uff08\u901a\u5e38\u662f\u4f7f\u7528\u8005\u540d\u7a31\u548c\u5bc6\u78bc\uff09\u767b\u9304\u5230\u591a\u500b\u4e0d\u540c\u7684\u61c9\u7528\u7a0b\u5f0f\u6216\u670d\u52d9\uff0c\u800c\u7121\u9700\u70ba\u6bcf\u500b\u61c9\u7528\u7a0b\u5f0f\u8f38\u5165\u6191\u8b49")),(0,a.kt)("h2",{id:"\u8cc7\u6599\u5eab"},"\u8cc7\u6599\u5eab"),(0,a.kt)("h3",{id:"\u8cc7\u6599\u5eab\u8a2d\u8a08\u8003\u91cf"},"\u8cc7\u6599\u5eab\u8a2d\u8a08\u8003\u91cf"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u4e00\u500b\u73fe\u4ee3\u5316\u7684 SSO \u7cfb\u7d71\uff0c\u7279\u5225\u662f\u57fa\u65bc OIDC \u548c JWT (JSON Web Tokens) \u7684\u7121\u72c0\u614b\uff08Stateless\uff09\u67b6\u69cb\uff0c\u5176\u8cc7\u6599\u5eab\u8a2d\u8a08\u9700\u8981\u8003\u91cf\u5e7e\u500b\u95dc\u9375\u9ede\u3002\u4ee5\u4e0b\u662f\u4e00\u500b\u66f4\u7b26\u5408\u696d\u754c\u5be6\u8e10\u7684\u8cc7\u6599\u5eab\u7d50\u69cb\u7bc4\u4f8b\u3002")),(0,a.kt)("h3",{id:"1-user-table\u4f7f\u7528\u8005\u8868\u683c"},"1. User Table\uff08\u4f7f\u7528\u8005\u8868\u683c\uff09"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5b58\u5132\u4f7f\u7528\u8005\u7684\u57fa\u672c\u8cc7\u8a0a\u3002",(0,a.kt)("inlineCode",{parentName:"p"},"username")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"email")," \u90fd\u61c9\u5177\u5099\u552f\u4e00\u6027\uff0c\u4ee5\u9632\u6b62\u8cc7\u6599\u91cd\u8907\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE user_table (\n    user_id serial PRIMARY KEY,\n    username VARCHAR(50) NOT NULL UNIQUE,\n    password_hash VARCHAR(255) NOT NULL,\n    email VARCHAR(100) UNIQUE,\n    status VARCHAR(20) NOT NULL DEFAULT 'active' -- e.g., active, inactive, locked\n);\n")),(0,a.kt)("h3",{id:"2-refresh-token-table\u5237\u65b0\u6b0a\u6756\u8868\u683c"},"2. Refresh Token Table\uff08\u5237\u65b0\u6b0a\u6756\u8868\u683c\uff09"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5728\u7121\u72c0\u614b\u7684 JWT \u67b6\u69cb\u4e2d\uff0c\u6211\u5011\u4e0d\u9700\u8981\u5728\u4f3a\u670d\u5668\u7aef\u4fdd\u5b58 ",(0,a.kt)("inlineCode",{parentName:"p"},"session"),"\u3002\u4f7f\u7528\u8005\u7684\u767b\u5165\u72c0\u614b\u7531 Access Token \u672c\u8eab\u4f86\u8b49\u660e\u3002\u7136\u800c\uff0c\u70ba\u4e86\u5b89\u5168\u5730\u63db\u767c\u65b0\u7684 Access Token\uff0c\u6211\u5011\u9700\u8981\u4e00\u500b\u5730\u65b9\u4f86\u5132\u5b58\u9577\u6548\u7684 Refresh Token\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE refresh_token_table (\n    token_id serial PRIMARY KEY,\n    user_id INT NOT NULL,\n    token_value TEXT NOT NULL,\n    expires_at TIMESTAMPTZ NOT NULL,\n    issued_at TIMESTAMPTZ NOT NULL DEFAULT current_timestamp,\n    \n    FOREIGN KEY (user_id) REFERENCES user_table (user_id) ON DELETE CASCADE\n);\n")),(0,a.kt)("h3",{id:"3-application-table\u61c9\u7528\u7a0b\u5f0f\u8868\u683c"},"3. Application Table\uff08\u61c9\u7528\u7a0b\u5f0f\u8868\u683c\uff09"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5b58\u5132\u8207 SSO \u7cfb\u7d71\u96c6\u6210\u7684\u5404\u500b\u61c9\u7528\u7a0b\u5f0f\uff08\u5728 OAuth2 \u4e2d\u7a31\u70ba Client\uff09\u7684\u8cc7\u8a0a\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE application_table (\n    app_id serial PRIMARY KEY,\n    app_name VARCHAR(100) NOT NULL UNIQUE,\n    client_id VARCHAR(100) NOT NULL UNIQUE,\n    client_secret_hash VARCHAR(255) NOT NULL,\n    redirect_uris TEXT[] NOT NULL -- An array of allowed redirect URIs\n);\n")),(0,a.kt)("h3",{id:"4-user-application-consent-table\u4f7f\u7528\u8005\u61c9\u7528\u7a0b\u5f0f\u6388\u6b0a\u8868\u683c"},"4. User-Application Consent Table\uff08\u4f7f\u7528\u8005\u61c9\u7528\u7a0b\u5f0f\u6388\u6b0a\u8868\u683c\uff09"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u7528\u65bc\u8a18\u9304\u4f7f\u7528\u8005\u540c\u610f\u6388\u6b0a\u7d66\u67d0\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u7bc4\u570d\uff08Scopes\uff09\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE user_app_consent (\n    consent_id serial PRIMARY KEY,\n    user_id INT NOT NULL,\n    app_id INT NOT NULL,\n    granted_scopes TEXT[] NOT NULL,\n    last_granted_at TIMESTAMPTZ NOT NULL DEFAULT current_timestamp,\n\n    FOREIGN KEY (user_id) REFERENCES user_table (user_id) ON DELETE CASCADE,\n    FOREIGN KEY (app_id) REFERENCES application_table (app_id) ON DELETE CASCADE,\n    UNIQUE (user_id, app_id)\n);\n")),(0,a.kt)("h3",{id:"5-audit-log-table\u5be9\u8a08\u65e5\u8a8c\u8868\u683c"},"5. Audit Log Table\uff08\u5be9\u8a08\u65e5\u8a8c\u8868\u683c\uff09"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u8a18\u9304\u8207\u5b89\u5168\u76f8\u95dc\u7684\u6d3b\u52d5\uff0c\u7528\u65bc\u8ffd\u8e64\u548c\u5206\u6790\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE audit_log (\n    log_id serial PRIMARY KEY,\n    user_id INT,\n    action VARCHAR(100) NOT NULL,\n    ip_address VARCHAR(50),\n    user_agent TEXT,\n    created_at TIMESTAMPTZ NOT NULL DEFAULT current_timestamp,\n\n    FOREIGN KEY (user_id) REFERENCES user_table (user_id) ON DELETE SET NULL\n);\n")),(0,a.kt)("h3",{id:"6-role-and-permission-tables\u89d2\u8272\u8207\u6b0a\u9650\u8868\u683c"},"6. Role and Permission Tables\uff08\u89d2\u8272\u8207\u6b0a\u9650\u8868\u683c\uff09"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5be6\u73fe RBAC (Role-Based Access Control) \u7684\u6838\u5fc3\u8868\u683c\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE role_table (\n    role_id serial PRIMARY KEY,\n    role_name VARCHAR(50) NOT NULL UNIQUE\n);\n\nCREATE TABLE permission_table (\n    permission_id serial PRIMARY KEY,\n    permission_name VARCHAR(100) NOT NULL UNIQUE,\n    description TEXT\n);\n\nCREATE TABLE user_role_mapping (\n    user_id INT NOT NULL,\n    role_id INT NOT NULL,\n    PRIMARY KEY (user_id, role_id),\n    FOREIGN KEY (user_id) REFERENCES user_table (user_id) ON DELETE CASCADE,\n    FOREIGN KEY (role_id) REFERENCES role_table (role_id) ON DELETE CASCADE\n);\n\nCREATE TABLE role_permission_mapping (\n    role_id INT NOT NULL,\n    permission_id INT NOT NULL,\n    PRIMARY KEY (role_id, permission_id),\n    FOREIGN KEY (role_id) REFERENCES role_table (role_id) ON DELETE CASCADE,\n    FOREIGN KEY (permission_id) REFERENCES permission_table (permission_id) ON DELETE CASCADE\n);\n")),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"\u5b8c\u6574-sql"},"\u5b8c\u6574 SQL"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE user_table (\n    user_id serial PRIMARY KEY,\n    username VARCHAR(50) NOT NULL UNIQUE,\n    password_hash VARCHAR(255) NOT NULL,\n    email VARCHAR(100) UNIQUE,\n    status VARCHAR(20) NOT NULL DEFAULT 'active' -- e.g., active, inactive, locked\n);\n\nCREATE TABLE refresh_token_table (\n    token_id serial PRIMARY KEY,\n    user_id INT NOT NULL,\n    token_value TEXT NOT NULL,\n    expires_at TIMESTAMPTZ NOT NULL,\n    issued_at TIMESTAMPTZ NOT NULL DEFAULT current_timestamp,\n    \n    FOREIGN KEY (user_id) REFERENCES user_table (user_id) ON DELETE CASCADE\n);\n\nCREATE TABLE application_table (\n    app_id serial PRIMARY KEY,\n    app_name VARCHAR(100) NOT NULL UNIQUE,\n    client_id VARCHAR(100) NOT NULL UNIQUE,\n    client_secret_hash VARCHAR(255) NOT NULL,\n    redirect_uris TEXT[] NOT NULL -- An array of allowed redirect URIs\n);\n\nCREATE TABLE user_app_consent (\n    consent_id serial PRIMARY KEY,\n    user_id INT NOT NULL,\n    app_id INT NOT NULL,\n    granted_scopes TEXT[] NOT NULL,\n    last_granted_at TIMESTAMPTZ NOT NULL DEFAULT current_timestamp,\n\n    FOREIGN KEY (user_id) REFERENCES user_table (user_id) ON DELETE CASCADE,\n    FOREIGN KEY (app_id) REFERENCES application_table (app_id) ON DELETE CASCADE,\n    UNIQUE (user_id, app_id)\n);\n\nCREATE TABLE audit_log (\n    log_id serial PRIMARY KEY,\n    user_id INT,\n    action VARCHAR(100) NOT NULL,\n    ip_address VARCHAR(50),\n    user_agent TEXT,\n    created_at TIMESTAMPTZ NOT NULL DEFAULT current_timestamp,\n\n    FOREIGN KEY (user_id) REFERENCES user_table (user_id) ON DELETE SET NULL\n);\n\nCREATE TABLE role_table (\n    role_id serial PRIMARY KEY,\n    role_name VARCHAR(50) NOT NULL UNIQUE\n);\n\nCREATE TABLE permission_table (\n    permission_id serial PRIMARY KEY,\n    permission_name VARCHAR(100) NOT NULL UNIQUE,\n    description TEXT\n);\n\nCREATE TABLE user_role_mapping (\n    user_id INT NOT NULL,\n    role_id INT NOT NULL,\n    PRIMARY KEY (user_id, role_id),\n    FOREIGN KEY (user_id) REFERENCES user_table (user_id) ON DELETE CASCADE,\n    FOREIGN KEY (role_id) REFERENCES role_table (role_id) ON DELETE CASCADE\n);\n\nCREATE TABLE role_permission_mapping (\n    role_id INT NOT NULL,\n    permission_id INT NOT NULL,\n    PRIMARY KEY (role_id, permission_id),\n    FOREIGN KEY (role_id) REFERENCES role_table (role_id) ON DELETE CASCADE,\n    FOREIGN KEY (permission_id) REFERENCES permission_table (permission_id) ON DELETE CASCADE\n);\n")))}d.isMDXComponent=!0}}]);